//Scripted
/*node('shared') {
    tool name: 'Default', type: 'git'
    properties([parameters([string(defaultValue: 'default', description: '', name: 'testString', trim: false)])])
    stage('Build') {
        echo 'Building....'
        checkout scm

        sh "echo 'Param is ${params.testString}'"
        checkpoint 'build-checkpoint'
    }
    stage('Test') {
        timeout(time: 30, unit: 'SECONDS') {
                withEnv(["TESTENV=envVar"]) {
                echo 'Building....'
                sh "echo 'Environment variable is ${env.TESTENV}'"
            }
            withCredentials([string(credentialsId: 'test-secret', variable: 'CREDTEST')]) {
                sh '''echo 'Cred string is ${CREDTEST}' '''
            }
        }
    }
    stage('Deploy') {
        input 'Deploy?'
        echo 'Deploying....'
        build 'downstream-test'
    }
    stage('Parallel') {
        parallel anyNode: {
            node('master') {
                sh '''echo 'I am the any node!' '''
            }
        },
        sharedNode: {
            node('shared') {
                sh '''echo 'I am the shared node!' '''
            }
        }
    }
}*/






//Declarative
pipeline {
    agent {
        label 'shared' 
    }
    parameters {
      string defaultValue: 'default', description: '', name: 'testString', trim: false
    } 
    tools {
      git 'Default'
    }
    stages {
        stage('Build') {
            steps {
                echo 'Building....'
                checkout scm

                sh "echo 'Param is ${params.testString}'"
                checkpoint 'build-checkpoint'
            }
        }
        stage('Test') {
            environment {
                TESTENV = 'envVar'
                CREDTEST = credentials('test-secret')
            }
            steps {
                timeout(time: 30, unit: 'SECONDS') {
                    echo 'Building....'
                    sh "echo 'Environment variable is ${env.TESTENV}'"
                        sh '''echo 'Cred string is ${env.CREDTEST}' '''
                }
            }
        }
        stage('Deploy') {
            steps {
                input 'Deploy?'
                echo 'Deploying....'
                build 'downstream-test'
            }
        }
        stage('Parallel') {
            parallel {
                stage {
                    agent {
                        label 'master'
                    }
                    steps {
                        sh '''echo 'I am the any node!' '''
                    }
                }
                 stage {
                    agent {
                        label 'shared'
                    }
                    steps {
                        sh '''echo 'I am the shared node!' '''
                    }
                }
            }
        }
    }
}


